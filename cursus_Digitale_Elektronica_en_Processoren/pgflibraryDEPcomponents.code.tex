\pgfdeclareshape{tris} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{c}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@y by -0.5\pgfutil@tempdima}
  \anchor{x}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{z}{\centerpoint\advance\pgf@x by\halfwidth}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}

  \backgroundpath{
     \pgfutil@tempdima=\halfwidth
     \centerpoint
     \advance\pgf@x by \halfwidth
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
  }
}
\pgfdeclareshape{nmosc} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\radius{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=.5\pgf@xb%
    \pgf@x=.5\pgf@yb%
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\radius}
  \anchor{drain}{\centerpoint\advance\pgf@y by\radius}
  \anchor{south}{\centerpoint\advance\pgf@y by-\radius}
  \anchor{source}{\centerpoint\advance\pgf@y by-\radius}
  \anchor{west}{\centerpoint\advance\pgf@x by-\radius}
  \anchor{gate}{\centerpoint\advance\pgf@x by-\radius}
  \anchor{east}{\centerpoint\advance\pgf@x by\radius}
  \anchor{mid west}{\centerpoint\advance\pgf@x by-\radius\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{mid east}{\centerpoint\advance\pgf@x by\radius\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base west}{\centerpoint\advance\pgf@x by-\radius\pgf@y=0pt}
  \anchor{base east}{\centerpoint\advance\pgf@x by\radius\pgf@y=0pt}
  \anchor{north west}{
    \centerpoint
    \pgf@xa=\radius
    \advance\pgf@x by-0.707107\pgf@xa
    \advance\pgf@y by0.707107\pgf@xa
  }
  \anchor{south west}{
    \centerpoint
    \pgf@xa=\radius
    \advance\pgf@x by-0.707107\pgf@xa
    \advance\pgf@y by-0.707107\pgf@xa
  }
  \anchor{north east}{
    \centerpoint
    \pgf@xa=\radius
    \advance\pgf@x by0.707107\pgf@xa
    \advance\pgf@y by0.707107\pgf@xa
  }
  \anchor{south east}{
    \centerpoint
    \pgf@xa=\radius
    \advance\pgf@x by0.707107\pgf@xa
    \advance\pgf@y by-0.707107\pgf@xa
  }
  \anchorborder{
    \pgf@xa=\pgf@x%
    \pgf@ya=\pgf@y%
    \edef\pgf@marshal{%
      \noexpand\pgfpointborderellipse
      {\noexpand\pgfqpoint{\the\pgf@xa}{\the\pgf@ya}}
      {\noexpand\pgfqpoint{\radius}{\radius}}%
    }%
    \pgf@marshal%
    \pgf@xa=\pgf@x%
    \pgf@ya=\pgf@y%
    \centerpoint%
    \advance\pgf@x by\pgf@xa%
    \advance\pgf@y by\pgf@ya%
  }

  \backgroundpath{
    \pgfutil@tempdima=\radius%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/outer xsep}}%  
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/outer ysep}}%  
    \ifdim\pgf@xb<\pgf@yb%
      \advance\pgfutil@tempdima by-\pgf@yb%
    \else%
      \advance\pgfutil@tempdima by-\pgf@xb%
    \fi%
    \pgfpathcircle{\centerpoint}{\pgfutil@tempdima}%
    \centerpoint
    \advance\pgf@y by -\pgfutil@tempdima
    \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
    \centerpoint
    \advance\pgf@y by -0.4\pgfutil@tempdima
    \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
    \centerpoint
    \advance\pgf@x by -0.32\pgfutil@tempdima
    \advance\pgf@y by -0.4\pgfutil@tempdima
    \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
    \centerpoint
    \advance\pgf@x by -0.32\pgfutil@tempdima
    \advance\pgf@y by 0.4\pgfutil@tempdima
    \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
    \centerpoint
    \advance\pgf@y by 0.4\pgfutil@tempdima
    \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
    \centerpoint
    \advance\pgf@y by \pgfutil@tempdima
    \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
  }
}


\pgfdeclareshape{nmoso} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\radius{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=.5\pgf@xb%
    \pgf@x=.5\pgf@yb%
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\radius}
  \anchor{drain}{\centerpoint\advance\pgf@y by\radius}
  \anchor{south}{\centerpoint\advance\pgf@y by-\radius}
  \anchor{source}{\centerpoint\advance\pgf@y by-\radius}
  \anchor{west}{\centerpoint\advance\pgf@x by-\radius}
  \anchor{gate}{\centerpoint\advance\pgf@x by-\radius}
  \anchor{east}{\centerpoint\advance\pgf@x by\radius}
  \anchor{mid west}{\centerpoint\advance\pgf@x by-\radius\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{mid east}{\centerpoint\advance\pgf@x by\radius\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base west}{\centerpoint\advance\pgf@x by-\radius\pgf@y=0pt}
  \anchor{base east}{\centerpoint\advance\pgf@x by\radius\pgf@y=0pt}
  \anchor{north west}{
    \centerpoint
    \pgf@xa=\radius
    \advance\pgf@x by-0.707107\pgf@xa
    \advance\pgf@y by0.707107\pgf@xa
  }
  \anchor{south west}{
    \centerpoint
    \pgf@xa=\radius
    \advance\pgf@x by-0.707107\pgf@xa
    \advance\pgf@y by-0.707107\pgf@xa
  }
  \anchor{north east}{
    \centerpoint
    \pgf@xa=\radius
    \advance\pgf@x by0.707107\pgf@xa
    \advance\pgf@y by0.707107\pgf@xa
  }
  \anchor{south east}{
    \centerpoint
    \pgf@xa=\radius
    \advance\pgf@x by0.707107\pgf@xa
    \advance\pgf@y by-0.707107\pgf@xa
  }
  \anchorborder{
    \pgf@xa=\pgf@x%
    \pgf@ya=\pgf@y%
    \edef\pgf@marshal{%
      \noexpand\pgfpointborderellipse
      {\noexpand\pgfqpoint{\the\pgf@xa}{\the\pgf@ya}}
      {\noexpand\pgfqpoint{\radius}{\radius}}%
    }%
    \pgf@marshal%
    \pgf@xa=\pgf@x%
    \pgf@ya=\pgf@y%
    \centerpoint%
    \advance\pgf@x by\pgf@xa%
    \advance\pgf@y by\pgf@ya%
  }

  \backgroundpath{
    \pgfutil@tempdima=\radius%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/outer xsep}}%  
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/outer ysep}}%  
    \ifdim\pgf@xb<\pgf@yb%
      \advance\pgfutil@tempdima by-\pgf@yb%
    \else%
      \advance\pgfutil@tempdima by-\pgf@xb%
    \fi%
    \pgfpathcircle{\centerpoint}{\pgfutil@tempdima}%
    \centerpoint
    \advance\pgf@y by -\pgfutil@tempdima
    \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
    \centerpoint
    \advance\pgf@y by -0.4\pgfutil@tempdima
    \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
    \centerpoint
    \advance\pgf@x by -0.32\pgfutil@tempdima
    \advance\pgf@y by -0.4\pgfutil@tempdima
    \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
    \centerpoint
    \advance\pgf@x by -0.64\pgfutil@tempdima
    \advance\pgf@y by 0.4\pgfutil@tempdima
    \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
    \centerpoint
    \advance\pgf@x by -0.32\pgfutil@tempdima
    \advance\pgf@y by 0.4\pgfutil@tempdima
    \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
    \centerpoint
    \advance\pgf@y by 0.4\pgfutil@tempdima
    \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
    \centerpoint
    \advance\pgf@y by \pgfutil@tempdima
    \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
  }
}

\pgfdeclareshape{pmosc} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\radius{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=.5\pgf@xb%
    \pgf@x=.5\pgf@yb%
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\radius}
  \anchor{drain}{\centerpoint\advance\pgf@y by-\radius}
  \anchor{south}{\centerpoint\advance\pgf@y by-\radius}
  \anchor{source}{\centerpoint\advance\pgf@y by\radius}
  \anchor{west}{\centerpoint\advance\pgf@x by-\radius}
  \anchor{gate}{\centerpoint\pgfutil@tempdima=\radius\advance\pgf@x by-1.4\pgfutil@tempdima}
  \anchor{east}{\centerpoint\advance\pgf@x by\radius}
  \anchor{mid west}{\centerpoint\advance\pgf@x by-\radius\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{mid east}{\centerpoint\advance\pgf@x by\radius\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base west}{\centerpoint\advance\pgf@x by-\radius\pgf@y=0pt}
  \anchor{base east}{\centerpoint\advance\pgf@x by\radius\pgf@y=0pt}
  \anchor{north west}{
    \centerpoint
    \pgf@xa=\radius
    \advance\pgf@x by-0.707107\pgf@xa
    \advance\pgf@y by0.707107\pgf@xa
  }
  \anchor{south west}{
    \centerpoint
    \pgf@xa=\radius
    \advance\pgf@x by-0.707107\pgf@xa
    \advance\pgf@y by-0.707107\pgf@xa
  }
  \anchor{north east}{
    \centerpoint
    \pgf@xa=\radius
    \advance\pgf@x by0.707107\pgf@xa
    \advance\pgf@y by0.707107\pgf@xa
  }
  \anchor{south east}{
    \centerpoint
    \pgf@xa=\radius
    \advance\pgf@x by0.707107\pgf@xa
    \advance\pgf@y by-0.707107\pgf@xa
  }
  \anchorborder{
    \pgf@xa=\pgf@x%
    \pgf@ya=\pgf@y%
    \edef\pgf@marshal{%
      \noexpand\pgfpointborderellipse
      {\noexpand\pgfqpoint{\the\pgf@xa}{\the\pgf@ya}}
      {\noexpand\pgfqpoint{\radius}{\radius}}%
    }%
    \pgf@marshal%
    \pgf@xa=\pgf@x%
    \pgf@ya=\pgf@y%
    \centerpoint%
    \advance\pgf@x by\pgf@xa%
    \advance\pgf@y by\pgf@ya%
  }

  \backgroundpath{
    \pgfutil@tempdima=\radius%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/outer xsep}}%  
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/outer ysep}}%  
    \ifdim\pgf@xb<\pgf@yb%
      \advance\pgfutil@tempdima by-\pgf@yb%
    \else%
      \advance\pgfutil@tempdima by-\pgf@xb%
    \fi%
    \pgfpathcircle{\centerpoint}{\pgfutil@tempdima}%
    \centerpoint
    \advance\pgf@x by -1.2\pgfutil@tempdima
    \pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{0.2\pgfutil@tempdima}%
    \centerpoint
    \advance\pgf@y by -\pgfutil@tempdima
    \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
    \centerpoint
    \advance\pgf@y by -0.4\pgfutil@tempdima
    \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
    \centerpoint
    \advance\pgf@x by -0.32\pgfutil@tempdima
    \advance\pgf@y by -0.4\pgfutil@tempdima
    \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
    \centerpoint
    \advance\pgf@x by -0.32\pgfutil@tempdima
    \advance\pgf@y by 0.4\pgfutil@tempdima
    \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
    \centerpoint
    \advance\pgf@y by 0.4\pgfutil@tempdima
    \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
    \centerpoint
    \advance\pgf@y by \pgfutil@tempdima
    \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
  }
}

\pgfdeclareshape{pmoso} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\radius{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=.5\pgf@xb%
    \pgf@x=.5\pgf@yb%
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\radius}
  \anchor{drain}{\centerpoint\advance\pgf@y by-\radius}
  \anchor{south}{\centerpoint\advance\pgf@y by-\radius}
  \anchor{source}{\centerpoint\advance\pgf@y by\radius}
  \anchor{west}{\centerpoint\advance\pgf@x by-\radius}
  \anchor{gate}{\centerpoint\pgfutil@tempdima=\radius\advance\pgf@x by-1.4\pgfutil@tempdima}
  \anchor{east}{\centerpoint\advance\pgf@x by\radius}
  \anchor{mid west}{\centerpoint\advance\pgf@x by-\radius\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{mid east}{\centerpoint\advance\pgf@x by\radius\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base west}{\centerpoint\advance\pgf@x by-\radius\pgf@y=0pt}
  \anchor{base east}{\centerpoint\advance\pgf@x by\radius\pgf@y=0pt}
  \anchor{north west}{
    \centerpoint
    \pgf@xa=\radius
    \advance\pgf@x by-0.707107\pgf@xa
    \advance\pgf@y by0.707107\pgf@xa
  }
  \anchor{south west}{
    \centerpoint
    \pgf@xa=\radius
    \advance\pgf@x by-0.707107\pgf@xa
    \advance\pgf@y by-0.707107\pgf@xa
  }
  \anchor{north east}{
    \centerpoint
    \pgf@xa=\radius
    \advance\pgf@x by0.707107\pgf@xa
    \advance\pgf@y by0.707107\pgf@xa
  }
  \anchor{south east}{
    \centerpoint
    \pgf@xa=\radius
    \advance\pgf@x by0.707107\pgf@xa
    \advance\pgf@y by-0.707107\pgf@xa
  }
  \anchorborder{
    \pgf@xa=\pgf@x%
    \pgf@ya=\pgf@y%
    \edef\pgf@marshal{%
      \noexpand\pgfpointborderellipse
      {\noexpand\pgfqpoint{\the\pgf@xa}{\the\pgf@ya}}
      {\noexpand\pgfqpoint{\radius}{\radius}}%
    }%
    \pgf@marshal%
    \pgf@xa=\pgf@x%
    \pgf@ya=\pgf@y%
    \centerpoint%
    \advance\pgf@x by\pgf@xa%
    \advance\pgf@y by\pgf@ya%
  }

  \backgroundpath{
    \pgfutil@tempdima=\radius%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/outer xsep}}%  
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/outer ysep}}%  
    \ifdim\pgf@xb<\pgf@yb%
      \advance\pgfutil@tempdima by-\pgf@yb%
    \else%
      \advance\pgfutil@tempdima by-\pgf@xb%
    \fi%
    \pgfpathcircle{\centerpoint}{\pgfutil@tempdima}%
    \centerpoint
    \advance\pgf@x by -1.2\pgfutil@tempdima
    \pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{0.2\pgfutil@tempdima}%
    \centerpoint
    \advance\pgf@y by -\pgfutil@tempdima
    \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
    \centerpoint
    \advance\pgf@y by -0.4\pgfutil@tempdima
    \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
    \centerpoint
    \advance\pgf@x by -0.32\pgfutil@tempdima
    \advance\pgf@y by -0.4\pgfutil@tempdima
    \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
    \centerpoint
    \advance\pgf@x by -0.64\pgfutil@tempdima
    \advance\pgf@y by 0.4\pgfutil@tempdima
    \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
    \centerpoint
    \advance\pgf@x by -0.32\pgfutil@tempdima
    \advance\pgf@y by 0.4\pgfutil@tempdima
    \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
    \centerpoint
    \advance\pgf@y by 0.4\pgfutil@tempdima
    \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
    \centerpoint
    \advance\pgf@y by \pgfutil@tempdima
    \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
  }
}

\pgfdeclareshape{alu} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{b}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.6666\pgfutil@tempdima}
  \anchor{a}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.6666\pgfutil@tempdima}
  \anchor{f}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@x by-0.8333\pgfutil@tempdima}
  \anchor{d}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@x by 0.8333\pgfutil@tempdima}
  \anchor{r}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{data0}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.6666\pgfutil@tempdima}
  \anchor{data1}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.6666\pgfutil@tempdima}
  \anchor{selin0}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@x by-0.8333\pgfutil@tempdima}
  \anchor{selout0}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@x by 0.8333\pgfutil@tempdima}
  \anchor{output}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}

  \backgroundpath{
     \pgfutil@tempdima=\halfwidth
     \centerpoint
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by 0.1666\pgfutil@tempdima
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by 0.6666\pgfutil@tempdima
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -0.6666\pgfutil@tempdima
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -0.1666\pgfutil@tempdima
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
  }
}

\pgfdeclareshape{shift} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{x}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{ni}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@x by-0.8333\pgfutil@tempdima}
  \anchor{no}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@x by 0.8333\pgfutil@tempdima}
  \anchor{f}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{data}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{selin0}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@x by-0.8333\pgfutil@tempdima}
  \anchor{selout0}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@x by 0.8333\pgfutil@tempdima}
  \anchor{output}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}

  \backgroundpath{
     \pgfutil@tempdima=\halfwidth
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by 0.6666\pgfutil@tempdima
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -0.6666\pgfutil@tempdima
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
  }
}

\pgfdeclareshape{mul} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{x}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.3333\pgfutil@tempdima}
  \anchor{y}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by 0.3333\pgfutil@tempdima}
  \anchor{left}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@x by-0.8333\pgfutil@tempdima}
  \anchor{right}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@x by 0.8333\pgfutil@tempdima}
  \anchor{f}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by-0.3333\pgfutil@tempdima}
  \anchor{g}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by 0.3333\pgfutil@tempdima}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}

  \backgroundpath{
     \pgfutil@tempdima=\halfwidth
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by 0.8333\pgfutil@tempdima
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -0.8333\pgfutil@tempdima
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
  }
}

\pgfdeclareshape{crystaloscillator} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{pin0}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{pin1}{\centerpoint\advance\pgf@x by\halfwidth}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}

  \backgroundpath{
     \pgfutil@tempdima=\halfwidth
     \centerpoint
     \advance\pgf@x by 0.8\pgfutil@tempdima
     \advance\pgf@y by \halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by 0.8\pgfutil@tempdima
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -0.8\pgfutil@tempdima
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -0.8\pgfutil@tempdima
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
     \centerpoint
     \advance\pgf@y by -\halfheight
     \advance\pgf@y by \halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@y by -\halfheight
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@y by \halfheight
     \advance\pgf@y by \halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@y by \halfheight
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
  }
}

\pgfdeclareshape{gndlow} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{pin0}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}

  \backgroundpath{
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -0.8333\pgfutil@tempdima
     \advance\pgf@y by -\halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by 0.8333\pgfutil@tempdima
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -0.6666\pgfutil@tempdima
     \advance\pgf@y by -\halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by 0.6666\pgfutil@tempdima
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
  }
}

\pgfdeclareshape{mux2to1} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{data0}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.3333\pgfutil@tempdima}
  \anchor{data1}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.3333\pgfutil@tempdima}
  \anchor{selin0}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@x by-0.8333\pgfutil@tempdima}
  \anchor{selout0}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@x by 0.8333\pgfutil@tempdima}
  \anchor{output}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}

  \backgroundpath{
     \pgfutil@tempdima=\halfwidth
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by 0.6666\pgfutil@tempdima
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -0.6666\pgfutil@tempdima
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
  }
}

\pgfdeclareshape{mux4to1} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{data0}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.6\pgfutil@tempdima}
  \anchor{data1}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.2\pgfutil@tempdima}
  \anchor{data2}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.2\pgfutil@tempdima}
  \anchor{data3}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.6\pgfutil@tempdima}
  \anchor{selin0}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@y by -0.333\pgfutil@tempdima\pgfutil@tempdima=\halfwidth\advance\pgf@x by-0.7777\pgfutil@tempdima}
  \anchor{selin1}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@y by 0.333\pgfutil@tempdima\pgfutil@tempdima=\halfwidth\advance\pgf@x by-0.8888\pgfutil@tempdima}
  \anchor{selout0}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@y by -0.333\pgfutil@tempdima\pgfutil@tempdima=\halfwidth\advance\pgf@x by 0.7777\pgfutil@tempdima}
  \anchor{selout1}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@y by 0.333\pgfutil@tempdima\pgfutil@tempdima=\halfwidth\advance\pgf@x by 0.8888\pgfutil@tempdima}
  \anchor{output}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}

  \backgroundpath{
     \pgfutil@tempdima=\halfwidth
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by 0.6666\pgfutil@tempdima
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -0.6666\pgfutil@tempdima
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
  }
}

\pgfdeclareshape{mux8to4} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{data13}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.8\pgfutil@tempdima}
  \anchor{data12}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.6\pgfutil@tempdima}
  \anchor{data11}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.4\pgfutil@tempdima}
  \anchor{data10}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.2\pgfutil@tempdima}
  \anchor{data03}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.2\pgfutil@tempdima}
  \anchor{data02}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.4\pgfutil@tempdima}
  \anchor{data01}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.6\pgfutil@tempdima}
  \anchor{data00}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.8\pgfutil@tempdima}
  \anchor{selin0}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@x by-0.8333\pgfutil@tempdima}
  \anchor{selout0}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@x by 0.8333\pgfutil@tempdima}
  \anchor{output3}{\centerpoint\advance\pgf@y by-\halfheight\pgfutil@tempdima=\halfwidth\advance\pgf@x by -0.3\pgfutil@tempdima}
  \anchor{output2}{\centerpoint\advance\pgf@y by-\halfheight\pgfutil@tempdima=\halfwidth\advance\pgf@x by -0.1\pgfutil@tempdima}
  \anchor{output1}{\centerpoint\advance\pgf@y by-\halfheight\pgfutil@tempdima=\halfwidth\advance\pgf@x by 0.1\pgfutil@tempdima}
  \anchor{output0}{\centerpoint\advance\pgf@y by-\halfheight\pgfutil@tempdima=\halfwidth\advance\pgf@x by 0.3\pgfutil@tempdima}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}

  \backgroundpath{
     \pgfutil@tempdima=\halfwidth
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by 0.6666\pgfutil@tempdima
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -0.6666\pgfutil@tempdima
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
  }
}

\pgfdeclareshape{mux8to1} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{data7}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.778\pgfutil@tempdima}
  \anchor{data6}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.556\pgfutil@tempdima}
  \anchor{data5}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.333\pgfutil@tempdima}
  \anchor{data4}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.111\pgfutil@tempdima}
  \anchor{data3}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.111\pgfutil@tempdima}
  \anchor{data2}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.333\pgfutil@tempdima}
  \anchor{data1}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.556\pgfutil@tempdima}
  \anchor{data0}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.778\pgfutil@tempdima}
  \anchor{selin0}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@y by -0.5\pgfutil@tempdima\pgfutil@tempdima=\halfwidth\advance\pgf@x by-0.75\pgfutil@tempdima}
  \anchor{selin1}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@x by-0.8333\pgfutil@tempdima}
  \anchor{selin2}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@y by 0.5\pgfutil@tempdima\pgfutil@tempdima=\halfwidth\advance\pgf@x by-0.9166\pgfutil@tempdima}
  \anchor{selout0}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@y by -0.5\pgfutil@tempdima\pgfutil@tempdima=\halfwidth\advance\pgf@x by 0.75\pgfutil@tempdima}
  \anchor{selout1}{\centerpoint\pgfutil@tempdima\pgfutil@tempdima=\halfwidth\advance\pgf@x by 0.8333\pgfutil@tempdima}
  \anchor{selout2}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@y by 0.5\pgfutil@tempdima\pgfutil@tempdima=\halfwidth\advance\pgf@x by 0.09166\pgfutil@tempdima}
  \anchor{output}{\centerpoint\advance\pgf@y by-\halfheight\pgfutil@tempdima=\halfwidth}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}

  \backgroundpath{
     \pgfutil@tempdima=\halfwidth
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by 0.6666\pgfutil@tempdima
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -0.6666\pgfutil@tempdima
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
  }
}

\pgfdeclareshape{decoder2to4} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{a0}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.3333\pgfutil@tempdima}
  \anchor{a1}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.3333\pgfutil@tempdima}
  \anchor{s0}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by0.6\pgfutil@tempdima}
  \anchor{s1}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by0.2\pgfutil@tempdima}
  \anchor{s2}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by-0.2\pgfutil@tempdima}
  \anchor{s3}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by-0.6\pgfutil@tempdima}
  \anchor{enable}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}

  \backgroundpath{
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
  }
}

\pgfdeclareshape{demux1to4} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{a0}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@x by-\halfwidth\advance\pgf@y by-0.3333\pgfutil@tempdima}
  \anchor{a1}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@x by-\halfwidth\advance\pgf@y by0.3333\pgfutil@tempdima}
  \anchor{s0}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by0.6\pgfutil@tempdima}
  \anchor{s1}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by0.2\pgfutil@tempdima}
  \anchor{s2}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by-0.2\pgfutil@tempdima}
  \anchor{s3}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by-0.6\pgfutil@tempdima}
  \anchor{data}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}

  \backgroundpath{
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
  }
}

\pgfdeclareshape{encoder4to2} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{f0}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by0.3333\pgfutil@tempdima}
  \anchor{f1}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by-0.3333\pgfutil@tempdima}
  \anchor{d0}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.6\pgfutil@tempdima}
  \anchor{d1}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.2\pgfutil@tempdima}
  \anchor{d2}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.2\pgfutil@tempdima}
  \anchor{d3}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.6\pgfutil@tempdima}
  \anchor{any}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}

  \backgroundpath{
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
  }
}

\pgfdeclareshape{comp} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{x1}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.3333\pgfutil@tempdima}
  \anchor{y1}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.3333\pgfutil@tempdima}
  \anchor{x0}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@x by\halfwidth\advance\pgf@y by0.3333\pgfutil@tempdima}
  \anchor{y0}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@x by\halfwidth\advance\pgf@y by-0.3333\pgfutil@tempdima}
  \anchor{g}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@x by-\halfwidth\advance\pgf@y by0.3333\pgfutil@tempdima}
  \anchor{l}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@x by-\halfwidth\advance\pgf@y by-0.3333\pgfutil@tempdima}
  \anchor{eq}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}

  \backgroundpath{
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
  }
}

\pgfdeclareshape{fulladder} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{s}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{x}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.3333\pgfutil@tempdima}
  \anchor{y}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.3333\pgfutil@tempdima}
  \anchor{co}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{ci}{\centerpoint\advance\pgf@x by\halfwidth}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}

  \backgroundpath{
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
  }
}

\pgfdeclareshape{cla} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{y}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.3333\pgfutil@tempdima}
  \anchor{x}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.3333\pgfutil@tempdima}
  \anchor{p}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by0.3333\pgfutil@tempdima}
  \anchor{g}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by-0.3333\pgfutil@tempdima}
  \anchor{s}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{c}{\centerpoint\advance\pgf@x by\halfwidth}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}

  \backgroundpath{
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
     \begingroup
     \tikzset{port labels}
     \tikz@textfont
     \pgf@anchor@cla@s
     \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.375ex}{s}}
     \pgf@anchor@cla@c
     \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-0.375ex}{c}}
     \pgf@anchor@cla@x
     \pgftext[top,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{\raisebox{-0.75ex}{x}}
     \pgf@anchor@cla@y
     \pgftext[top,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{\raisebox{-0.75ex}{y}}
     \pgf@anchor@cla@p
     \pgftext[bottom,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep]{\raisebox{0.0ex}{p}}
     \pgf@anchor@cla@g
     \pgftext[bottom,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep]{\raisebox{0.0ex}{g}}
     \endgroup
  }
}

\pgfdeclareshape{clagc} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{c}{\centerpoint\advance\pgf@x by\halfwidth}
  \anchor{pa}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.8182\pgfutil@tempdima}
  \anchor{ga}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.6364\pgfutil@tempdima}
  \anchor{ca}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by0.7272\pgfutil@tempdima}
  \anchor{pb}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.0909\pgfutil@tempdima}
  \anchor{gb}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.0909\pgfutil@tempdima}
  \anchor{cb}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by0.0\pgfutil@tempdima}
  \anchor{pc}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.6364\pgfutil@tempdima}
  \anchor{gc}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.8182\pgfutil@tempdima}
  \anchor{cc}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by-0.7272\pgfutil@tempdima}
  \anchor{gab}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@y by0.3333\pgfutil@tempdima\advance\pgf@x by-\halfwidth}
  \anchor{pab}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@y by-0.3333\pgfutil@tempdima\advance\pgf@x by-\halfwidth}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}

  \backgroundpath{
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
     \begingroup
     \tikzset{port labels}
     \tikz@textfont
     %\pgf@anchor@cla@s
     %\pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.375ex}{s}}
     \pgf@anchor@clagc@c
     \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-0.375ex}{c$_0$}}
     \pgf@anchor@clagc@pa
     \pgftext[top,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{\raisebox{-0.75ex}{p$_0$}}
     \pgf@anchor@clagc@ga
     \pgftext[top,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{\raisebox{-0.75ex}{g$_0$}}
     \pgf@anchor@clagc@ca
     \pgftext[bottom,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep]{\raisebox{0.0ex}{c$_1$}}
     \pgf@anchor@clagc@pb
     \pgftext[top,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{\raisebox{-0.75ex}{p$_1$}}
     \pgf@anchor@clagc@gb
     \pgftext[top,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{\raisebox{-0.75ex}{g$_1$}}
     \pgf@anchor@clagc@cb
     \pgftext[bottom,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep]{\raisebox{0.0ex}{c$_2$}}
     \pgf@anchor@clagc@pc
     \pgftext[top,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{\raisebox{-0.75ex}{p$_2$}}
     \pgf@anchor@clagc@gc
     \pgftext[top,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{\raisebox{-0.75ex}{g$_2$}}
     \pgf@anchor@clagc@cc
     \pgftext[bottom,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep]{\raisebox{0.0ex}{c$_3$}}
     \pgf@anchor@clagc@gab
     \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{0.0ex}{g$_{0,2}$}}
     \pgf@anchor@clagc@pab
     \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{0.0ex}{p$_{0,2}$}}
     \endgroup
  }
}

\pgfdeclareshape{addsubtractor} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{s}{\centerpoint\advance\pgf@x by\halfwidth}
  \anchor{c}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{X}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.3333\pgfutil@tempdima}
  \anchor{Y}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.3333\pgfutil@tempdima}
  \anchor{F}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}

  \backgroundpath{
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
  }
}

\pgfdeclareshape{ale} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{a}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.5\pgfutil@tempdima}
  \anchor{b}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{m}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.375\pgfutil@tempdima}
  \anchor{ia}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.5\pgfutil@tempdima}
  \anchor{ib}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.625\pgfutil@tempdima}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{x}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by-0.25\pgfutil@tempdima}
  \anchor{y}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by0.25\pgfutil@tempdima}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}

  \backgroundpath{
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
  }
}

\pgfdeclareshape{cig} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{c}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{m}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.5\pgfutil@tempdima}
  \anchor{ia}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{ib}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.5\pgfutil@tempdima}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}

  \backgroundpath{
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
  }
}

\pgfdeclareshape{nadder} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{xd}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.7777\pgfutil@tempdima}
  \anchor{xc}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.5555\pgfutil@tempdima}
  \anchor{xb}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.3333\pgfutil@tempdima}
  \anchor{xa}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.1111\pgfutil@tempdima}
  \anchor{yd}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.1111\pgfutil@tempdima}
  \anchor{yc}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.3333\pgfutil@tempdima}
  \anchor{yb}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.5555\pgfutil@tempdima}
  \anchor{ya}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.7777\pgfutil@tempdima}
  \anchor{sd}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by-0.3333\pgfutil@tempdima}
  \anchor{sc}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by-0.1111\pgfutil@tempdima}
  \anchor{sb}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by0.1111\pgfutil@tempdima}
  \anchor{sa}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by0.3333\pgfutil@tempdima}
  \anchor{c}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}

  \backgroundpath{
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
     \begingroup
     \tikzset{port labels}
     \tikz@textfont
     \pgf@anchor@nadder@xa
     \pgftext[top,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{\raisebox{-0.75ex}{x$_0$}}
     \pgf@anchor@nadder@xb
     \pgftext[top,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{\raisebox{-0.75ex}{x$_1$}}
     \pgf@anchor@nadder@xc
     \pgftext[top,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{\raisebox{-0.75ex}{$\ldots$}}
     \pgf@anchor@nadder@xd
     \pgftext[top,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{\raisebox{-0.75ex}{x$_{n-1}$}}
     \pgf@anchor@nadder@ya
     \pgftext[top,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{\raisebox{-0.75ex}{y$_0$}}
     \pgf@anchor@nadder@yb
     \pgftext[top,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{\raisebox{-0.75ex}{y$_1$}}
     \pgf@anchor@nadder@yc
     \pgftext[top,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{\raisebox{-0.75ex}{$\ldots$}}
     \pgf@anchor@nadder@yd
     \pgftext[top,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{\raisebox{-0.75ex}{y$_{n-1}$}}
     \pgf@anchor@nadder@sa
     \pgftext[bottom,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep]{\raisebox{0.0ex}{s$_0$}}
     \pgf@anchor@nadder@sb
     \pgftext[bottom,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep]{\raisebox{0.0ex}{s$_1$}}
     \pgf@anchor@nadder@sc
     \pgftext[bottom,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep]{\raisebox{0.0ex}{$\ldots$}}
     \pgf@anchor@nadder@sd
     \pgftext[bottom,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep]{\raisebox{0.0ex}{s$_{n-1}$}}
     \pgf@anchor@nadder@c
     \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{0.0ex}{c}}
     \endgroup
  }
}
\pgfdeclareshape{dadder} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{xd}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.7777\pgfutil@tempdima}
  \anchor{xc}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.5555\pgfutil@tempdima}
  \anchor{xb}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.3333\pgfutil@tempdima}
  \anchor{xa}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.1111\pgfutil@tempdima}
  \anchor{yd}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.1111\pgfutil@tempdima}
  \anchor{yc}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.3333\pgfutil@tempdima}
  \anchor{yb}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.5555\pgfutil@tempdima}
  \anchor{ya}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.7777\pgfutil@tempdima}
  \anchor{sd}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by-0.3333\pgfutil@tempdima}
  \anchor{sc}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by-0.1111\pgfutil@tempdima}
  \anchor{sb}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by0.1111\pgfutil@tempdima}
  \anchor{sa}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by0.3333\pgfutil@tempdima}
  \anchor{co}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{ci}{\centerpoint\advance\pgf@x by\halfwidth}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}

  \backgroundpath{
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
     \begingroup
     \tikzset{port labels}
     \tikz@textfont
     \pgf@anchor@nadder@xa
     \pgftext[top,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{\raisebox{-0.75ex}{x$_0$}}
     \pgf@anchor@nadder@xb
     \pgftext[top,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{\raisebox{-0.75ex}{x$_1$}}
     \pgf@anchor@nadder@xc
     \pgftext[top,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{\raisebox{-0.75ex}{x$_2$}}
     \pgf@anchor@nadder@xd
     \pgftext[top,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{\raisebox{-0.75ex}{x$_3$}}
     \pgf@anchor@nadder@ya
     \pgftext[top,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{\raisebox{-0.75ex}{y$_0$}}
     \pgf@anchor@nadder@yb
     \pgftext[top,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{\raisebox{-0.75ex}{y$_1$}}
     \pgf@anchor@nadder@yc
     \pgftext[top,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{\raisebox{-0.75ex}{y$_2$}}
     \pgf@anchor@nadder@yd
     \pgftext[top,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{\raisebox{-0.75ex}{y$_3$}}
     \pgf@anchor@nadder@sa
     \pgftext[bottom,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep]{\raisebox{0.0ex}{s$_0$}}
     \pgf@anchor@nadder@sb
     \pgftext[bottom,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep]{\raisebox{0.0ex}{s$_1$}}
     \pgf@anchor@nadder@sc
     \pgftext[bottom,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep]{\raisebox{0.0ex}{s$_2$}}
     \pgf@anchor@nadder@sd
     \pgftext[bottom,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep]{\raisebox{0.0ex}{s$_3$}}
     \endgroup
  }
}

\pgfdeclareshape{srlatch}{
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \inheritanchorborder[from=rectangle]
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }
  \anchor{Q}{
    \pgf@process{\northeast}%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Qn}{
    \pgf@process{\northeast}%
    \pgf@y=-.5\pgf@y%
  }
  \anchor{S}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=.5\pgf@y%
  }
  \anchor{R}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=-0.5\pgf@y%
  }
  % Draw the rectangle box and the port labels
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}
    % Angle (>) for clock input

    % Draw port labels
    \begingroup
    \tikzset{flip flop/port labels} % Use font from this style
    \tikz@textfont

    \pgf@anchor@srlatch@Q
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Q}}

    \pgf@anchor@srlatch@Qn
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{$\overline{\mbox{Q}}$}}

    \pgf@anchor@srlatch@R
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{R}}

    \pgf@anchor@srlatch@S
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{S}}
    \endgroup
  }
}

\pgfdeclareshape{srlatchnand}{
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \inheritanchorborder[from=rectangle]
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }
  \anchor{Q}{
    \pgf@process{\northeast}%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Qn}{
    \pgf@process{\northeast}%
    \pgf@y=-.5\pgf@y%
  }
  \anchor{S}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=.5\pgf@y%
  }
  \anchor{R}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=-0.5\pgf@y%
  }
  % Draw the rectangle box and the port labels
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}
    % Angle (>) for clock input

    % Draw port labels
    \begingroup
    \tikzset{flip flop/port labels} % Use font from this style
    \tikz@textfont

    \pgf@anchor@srlatchnand@Q
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Q}}

    \pgf@anchor@srlatchnand@Qn
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{$\overline{\mbox{Q}}$}}

    \pgf@anchor@srlatchnand@R
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{$\overline{\mbox{R}}$}}

    \pgf@anchor@srlatchnand@S
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{$\overline{\mbox{S}}$}}
    \endgroup
  }
}

\pgfdeclareshape{clsrlatch}{
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \inheritanchorborder[from=rectangle]
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }
  \anchor{Q}{
    \pgf@process{\northeast}%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Qn}{
    \pgf@process{\northeast}%
    \pgf@y=-.5\pgf@y%
  }
  \anchor{S}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Clk}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=0pt%
  }
  \anchor{R}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=-0.5\pgf@y%
  }
  % Draw the rectangle box and the port labels
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}
    % Angle (>) for clock input

    % Draw port labels
    \begingroup
    \tikzset{flip flop/port labels} % Use font from this style
    \tikz@textfont

    \pgf@anchor@clsrlatch@Q
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Q}}

    \pgf@anchor@clsrlatch@Qn
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{$\overline{\mbox{Q}}$}}

    \pgf@anchor@clsrlatch@R
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{R}}

    \pgf@anchor@clsrlatch@Clk
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Clk}}

    \pgf@anchor@clsrlatch@S
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{S}}
    \endgroup
  }
}

\pgfdeclareshape{cldlatch}{
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \inheritanchorborder[from=rectangle]
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }
  \anchor{Q}{
    \pgf@process{\northeast}%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Qn}{
    \pgf@process{\northeast}%
    \pgf@y=-.5\pgf@y%
  }
  \anchor{D}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Clk}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=-0.5\pgf@y%
  }
  % Draw the rectangle box and the port labels
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}
    % Angle (>) for clock input

    % Draw port labels
    \begingroup
    \tikzset{flip flop/port labels} % Use font from this style
    \tikz@textfont

    \pgf@anchor@cldlatch@Q
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Q}}

    \pgf@anchor@cldlatch@Qn
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{$\overline{\mbox{Q}}$}}

    \pgf@anchor@cldlatch@D
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{D}}

    \pgf@anchor@cldlatch@Clk
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Clk}}
    \endgroup
  }
}

\pgfdeclareshape{cldlatchmaster}{
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \inheritanchorborder[from=rectangle]
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }
  \anchor{Q}{
    \pgf@process{\northeast}%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Qn}{
    \pgf@process{\northeast}%
    \pgf@y=-.5\pgf@y%
  }
  \anchor{D}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=.5\pgf@y%
  }
  \anchor{ClkT}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=-0.5\pgf@y%
  }
  \anchor{Clk}{
    \pgf@process{\northeast}%
    \pgf@x=-1.4\pgf@x%
    \pgf@y=-0.5\pgf@y%
  }
  % Draw the rectangle box and the port labels
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}

    \pgf@anchor@cldlatchmaster@ClkT
    \pgfutil@tempdima=\pgf@x
    \advance\pgf@x by 0.2\pgfutil@tempdima
    \pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{0.166667\pgfutil@tempdima}
    % Angle (>) for clock input

    % Draw port labels
    \begingroup
    \tikzset{flip flop/port labels} % Use font from this style
    \tikz@textfont

    \pgf@anchor@cldlatchmaster@Q
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Q}}

    \pgf@anchor@cldlatchmaster@Qn
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{$\overline{\mbox{Q}}$}}

    \pgf@anchor@cldlatchmaster@D
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{D}}

    \pgf@anchor@cldlatchmaster@ClkT
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Clk}}
    \endgroup
  }
}

\pgfdeclareshape{srff}{
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \inheritanchorborder[from=rectangle]
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }
  \anchor{Q}{
    \pgf@process{\northeast}%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Qn}{
    \pgf@process{\northeast}%
    \pgf@y=-.5\pgf@y%
  }
  \anchor{S}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Clk}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=0pt%
  }
  \anchor{R}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=-0.5\pgf@y%
  }
  % Draw the rectangle box and the port labels
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}
    % Angle (>) for clock input
    \pgf@anchor@srff@Clk
    \pgf@xa=\pgf@x \pgf@ya=\pgf@y
    \pgf@xb=\pgf@x \pgf@yb=\pgf@y
    \pgf@xc=\pgf@x \pgf@yc=\pgf@y
    \pgfmathsetlength\pgf@x{1.6ex} % size depends on font size
    \advance\pgf@ya by \pgf@x
    \advance\pgf@xb by \pgf@x
    \advance\pgf@yc by -\pgf@x
    \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
    \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
    \pgfclosepath

    % Draw port labels
    \begingroup
    \tikzset{flip flop/port labels} % Use font from this style
    \tikz@textfont

    \pgf@anchor@srff@Q
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Q}}

    \pgf@anchor@srff@Qn
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{$\overline{\mbox{Q}}$}}

    \pgf@anchor@srff@R
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{R}}

    \pgf@anchor@srff@Clk
    \pgftext[left,base,at={\pgfpoint{\pgf@xb}{\pgf@yb}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Clk}}

    \pgf@anchor@srff@S
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{S}}
    \endgroup
  }
}

\pgfdeclareshape{dff}{
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \inheritanchorborder[from=rectangle]
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }
  \anchor{Q}{
    \pgf@process{\northeast}%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Qn}{
    \pgf@process{\northeast}%
    \pgf@y=-.5\pgf@y%
  }
  \anchor{D}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Clk}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=-0.5\pgf@y
  }
  % Draw the rectangle box and the port labels
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}
    % Angle (>) for clock input
    \pgf@anchor@dff@Clk
    \pgf@xa=\pgf@x \pgf@ya=\pgf@y
    \pgf@xb=\pgf@x \pgf@yb=\pgf@y
    \pgf@xc=\pgf@x \pgf@yc=\pgf@y
    \pgfmathsetlength\pgf@x{1.6ex} % size depends on font size
    \advance\pgf@ya by \pgf@x
    \advance\pgf@xb by \pgf@x
    \advance\pgf@yc by -\pgf@x
    \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
    \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
    \pgfclosepath

    % Draw port labels
    \begingroup
    \tikzset{flip flop/port labels} % Use font from this style
    \tikz@textfont

    \pgf@anchor@dff@Q
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Q}}

    \pgf@anchor@dff@Qn
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{$\overline{\mbox{Q}}$}}

    \pgf@anchor@dff@D
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{D}}

    \pgf@anchor@dff@Clk
    \pgftext[left,base,at={\pgfpoint{\pgf@xb}{\pgf@yb}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Clk}}
    \endgroup
  }
}

\pgfdeclareshape{tff}{
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \inheritanchorborder[from=rectangle]
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }
  \anchor{Q}{
    \pgf@process{\northeast}%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Qn}{
    \pgf@process{\northeast}%
    \pgf@y=-.5\pgf@y%
  }
  \anchor{T}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Clk}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=-0.5\pgf@y
  }
  % Draw the rectangle box and the port labels
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}
    % Angle (>) for clock input
    \pgf@anchor@tff@Clk
    \pgf@xa=\pgf@x \pgf@ya=\pgf@y
    \pgf@xb=\pgf@x \pgf@yb=\pgf@y
    \pgf@xc=\pgf@x \pgf@yc=\pgf@y
    \pgfmathsetlength\pgf@x{1.6ex} % size depends on font size
    \advance\pgf@ya by \pgf@x
    \advance\pgf@xb by \pgf@x
    \advance\pgf@yc by -\pgf@x
    \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
    \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
    \pgfclosepath

    % Draw port labels
    \begingroup
    \tikzset{flip flop/port labels} % Use font from this style
    \tikz@textfont

    \pgf@anchor@tff@Q
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Q}}

    \pgf@anchor@tff@Qn
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{$\overline{\mbox{Q}}$}}

    \pgf@anchor@tff@T
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{T}}

    \pgf@anchor@tff@Clk
    \pgftext[left,base,at={\pgfpoint{\pgf@xb}{\pgf@yb}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Clk}}
    \endgroup
  }
}

\pgfdeclareshape{jkff}{
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \inheritanchorborder[from=rectangle]
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }
  \anchor{Q}{
    \pgf@process{\northeast}%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Qn}{
    \pgf@process{\northeast}%
    \pgf@y=-.5\pgf@y%
  }
  \anchor{K}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=-0.5\pgf@y%
  }
  \anchor{Clk}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=0pt%
  }
  \anchor{J}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=0.5\pgf@y%
  }
  % Draw the rectangle box and the port labels
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}
    % Angle (>) for clock input
    \pgf@anchor@jkff@Clk
    \pgf@xa=\pgf@x \pgf@ya=\pgf@y
    \pgf@xb=\pgf@x \pgf@yb=\pgf@y
    \pgf@xc=\pgf@x \pgf@yc=\pgf@y
    \pgfmathsetlength\pgf@x{1.6ex} % size depends on font size
    \advance\pgf@ya by \pgf@x
    \advance\pgf@xb by \pgf@x
    \advance\pgf@yc by -\pgf@x
    \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
    \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
    \pgfclosepath

    % Draw port labels
    \begingroup
    \tikzset{flip flop/port labels} % Use font from this style
    \tikz@textfont

    \pgf@anchor@jkff@Q
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Q}}

    \pgf@anchor@jkff@Qn
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{$\overline{\mbox{Q}}$}}

    \pgf@anchor@jkff@K
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{K}}

    \pgf@anchor@jkff@Clk
    \pgftext[left,base,at={\pgfpoint{\pgf@xb}{\pgf@yb}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Clk}}

    \pgf@anchor@jkff@J
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{J}}
    \endgroup
  }
}

\pgfdeclareshape{srffx}{
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \inheritanchorborder[from=rectangle]
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }
  \anchor{Q}{
    \pgf@process{\northeast}%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Qn}{
    \pgf@process{\northeast}%
    \pgf@y=-.5\pgf@y%
  }
  \anchor{S}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Clk}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=0pt%
  }
  \anchor{R}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=-0.5\pgf@y%
  }
  \anchor{PR}{
    \pgf@process{\northeast}%
    \pgf@x=0pt%
  }
  \anchor{CLR}{
    \pgf@process{\northeast}%
    \pgf@x=0pt%
    \pgf@y=-\pgf@y%
  }
  % Draw the rectangle box and the port labels
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}
    % Angle (>) for clock input
    \pgf@anchor@srffx@Clk
    \pgf@xa=\pgf@x \pgf@ya=\pgf@y
    \pgf@xb=\pgf@x \pgf@yb=\pgf@y
    \pgf@xc=\pgf@x \pgf@yc=\pgf@y
    \pgfmathsetlength\pgf@x{1.6ex} % size depends on font size
    \advance\pgf@ya by \pgf@x
    \advance\pgf@xb by \pgf@x
    \advance\pgf@yc by -\pgf@x
    \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
    \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
    \pgfclosepath

    % Draw port labels
    \begingroup
    \tikzset{flip flop/port labels} % Use font from this style
    \tikz@textfont

    \pgf@anchor@srffx@Q
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Q}}

    \pgf@anchor@srffx@Qn
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{$\overline{\mbox{Q}}$}}

    \pgf@anchor@srffx@R
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{R}}

    \pgf@anchor@srffx@Clk
    \pgftext[left,base,at={\pgfpoint{\pgf@xb}{\pgf@yb}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Clk}}

    \pgf@anchor@srffx@S
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{S}}

    \pgf@anchor@srffx@PR
    \pgftext[top,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{PR}

    \pgf@anchor@srffx@CLR
    \pgftext[bottom,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep]{CLR}
    \endgroup
  }
}

\pgfdeclareshape{srffxn}{
  % The 'minimum width' and 'minimum height' keys, not the content, determine
  % the size
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  % This is redundant, but makes some things easier:
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \saveddimen\radius{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=.5\pgf@xb%
    \pgf@x=.5\pgf@yb%
  }
  % Inherit from rectangle
  \inheritanchorborder[from=rectangle]

  % Define same anchor a normal rectangle has
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }

  % Define anchors for signal ports
  \anchor{Q}{
    \pgf@process{\northeast}%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Qn}{
    \pgf@process{\northeast}%
    \pgf@y=-.5\pgf@y%
  }
  \anchor{S}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Clk}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=0pt%
  }
  \anchor{R}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=-0.5\pgf@y%
  }
  \anchor{PR}{
    \pgf@process{\northeast}%
    \pgfutil@tempdima=\radius
    \pgf@x=0pt%
    \advance\pgf@y by 0.2\pgfutil@tempdima
  }
  \anchor{CLR}{
    \pgf@process{\northeast}%
    \pgfutil@tempdima=\radius
    \pgf@x=0pt%
    \pgf@y=-\pgf@y%
    \advance\pgf@y by -0.2\pgfutil@tempdima
  }
  % Draw the rectangle box and the port labels
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}
    \pgfutil@tempdima=\radius
    \pgf@anchor@dffx@PR
    \advance\pgf@y by 0.1\pgfutil@tempdima
    \pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{0.1\pgfutil@tempdima}
    \pgf@anchor@dffx@CLR
    \advance\pgf@y by -0.1\pgfutil@tempdima
    \pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{0.1\pgfutil@tempdima}
    % Angle (>) for clock input
    \pgf@anchor@jkffxn@Clk
    \pgf@xa=\pgf@x \pgf@ya=\pgf@y
    \pgf@xb=\pgf@x \pgf@yb=\pgf@y
    \pgf@xc=\pgf@x \pgf@yc=\pgf@y
    \pgfmathsetlength\pgf@x{1.6ex} % size depends on font size
    \advance\pgf@ya by \pgf@x
    \advance\pgf@xb by \pgf@x
    \advance\pgf@yc by -\pgf@x
    \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
    \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
    \pgfclosepath

    % Draw port labels
    \begingroup
    \tikzset{flip flop/port labels} % Use font from this style
    \tikz@textfont

    \pgf@anchor@srffxn@Q
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Q}}

    \pgf@anchor@srffxn@Qn
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{$\overline{\mbox{Q}}$}}

    \pgf@anchor@srffxn@R
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{R}}

    \pgf@anchor@srffxn@Clk
    \pgftext[left,base,at={\pgfpoint{\pgf@xb}{\pgf@yb}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Clk}}

    \pgf@anchor@srffxn@S
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{S}}

    \pgf@anchor@srffx@PR
    \pgftext[top,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{PR}

    \pgf@anchor@srffx@CLR
    \pgftext[bottom,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep]{CLR}
    \endgroup
  }
}

\pgfdeclareshape{tffx}{
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \inheritanchorborder[from=rectangle]
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }
  \anchor{Q}{
    \pgf@process{\northeast}%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Qn}{
    \pgf@process{\northeast}%
    \pgf@y=-.5\pgf@y%
  }
  \anchor{T}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Clk}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=-0.5\pgf@y
  }
  \anchor{PR}{
    \pgf@process{\northeast}%
    \pgf@x=0pt%
  }
  \anchor{CLR}{
    \pgf@process{\northeast}%
    \pgf@x=0pt%
    \pgf@y=-\pgf@y%
  }
  % Draw the rectangle box and the port labels
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}
    % Angle (>) for clock input
    \pgf@anchor@tffx@Clk
    \pgf@xa=\pgf@x \pgf@ya=\pgf@y
    \pgf@xb=\pgf@x \pgf@yb=\pgf@y
    \pgf@xc=\pgf@x \pgf@yc=\pgf@y
    \pgfmathsetlength\pgf@x{1.6ex} % size depends on font size
    \advance\pgf@ya by \pgf@x
    \advance\pgf@xb by \pgf@x
    \advance\pgf@yc by -\pgf@x
    \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
    \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
    \pgfclosepath

    % Draw port labels
    \begingroup
    \tikzset{flip flop/port labels} % Use font from this style
    \tikz@textfont

    \pgf@anchor@tffx@Q
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Q}}

    \pgf@anchor@tffx@Qn
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{$\overline{\mbox{Q}}$}}

    \pgf@anchor@tffx@T
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{T}}

    \pgf@anchor@tffx@Clk
    \pgftext[left,base,at={\pgfpoint{\pgf@xb}{\pgf@yb}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Clk}}

    \pgf@anchor@tffx@PR
    \pgftext[top,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{PR}

    \pgf@anchor@tffx@CLR
    \pgftext[bottom,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep]{CLR}
    \endgroup
  }
}

\pgfdeclareshape{dffx}{
  % The 'minimum width' and 'minimum height' keys, not the content, determine
  % the size
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  % This is redundant, but makes some things easier:
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  % Inherit from rectangle
  \inheritanchorborder[from=rectangle]

  % Define same anchor a normal rectangle has
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }

  % Define anchors for signal ports
  \anchor{D}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Clk}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=-.5\pgf@y%
  }
  \anchor{Q}{
    \pgf@process{\northeast}%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Qn}{
    \pgf@process{\northeast}%
    \pgf@y=-.5\pgf@y%
  }
  \anchor{PR}{
    \pgf@process{\northeast}%
    \pgf@x=0pt%
  }
  \anchor{CLR}{
    \pgf@process{\northeast}%
    \pgf@x=0pt%
    \pgf@y=-\pgf@y%
  }
  % Draw the rectangle box and the port labels
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}
    % Angle (>) for clock input
    \pgf@anchor@dffx@Clk
    \pgf@xa=\pgf@x \pgf@ya=\pgf@y
    \pgf@xb=\pgf@x \pgf@yb=\pgf@y
    \pgf@xc=\pgf@x \pgf@yc=\pgf@y
    \pgfmathsetlength\pgf@x{1.6ex} % size depends on font size
    \advance\pgf@ya by \pgf@x
    \advance\pgf@xb by \pgf@x
    \advance\pgf@yc by -\pgf@x
    \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
    \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
    \pgfclosepath

    % Draw port labels
    \begingroup
    \tikzset{flip flop/port labels} % Use font from this style
    \tikz@textfont

    \pgf@anchor@dffx@D
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{D}}

    \pgf@anchor@dffx@Q
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Q}}

    \pgf@anchor@dffx@Qn
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{$\overline{\mbox{Q}}$}}

    \pgf@anchor@dffx@Clk
    \pgftext[left,base,at={\pgfpoint{\pgf@xb}{\pgf@yb}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Clk}}

    \pgf@anchor@dffx@PR
    \pgftext[top,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{PR}

    \pgf@anchor@dffx@CLR
    \pgftext[bottom,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep]{CLR}
    \endgroup
  }
}

\pgfdeclareshape{tffxn}{
  % The 'minimum width' and 'minimum height' keys, not the content, determine
  % the size
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  % This is redundant, but makes some things easier:
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \saveddimen\radius{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=.5\pgf@xb%
    \pgf@x=.5\pgf@yb%
  }
  % Inherit from rectangle
  \inheritanchorborder[from=rectangle]

  % Define same anchor a normal rectangle has
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }

  % Define anchors for signal ports
  \anchor{Q}{
    \pgf@process{\northeast}%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Qn}{
    \pgf@process{\northeast}%
    \pgf@y=-.5\pgf@y%
  }
  \anchor{T}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Clk}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=-0.5\pgf@y
  }
  \anchor{PR}{
    \pgf@process{\northeast}%
    \pgfutil@tempdima=\radius
    \pgf@x=0pt%
    \advance\pgf@y by 0.2\pgfutil@tempdima
  }
  \anchor{CLR}{
    \pgf@process{\northeast}%
    \pgfutil@tempdima=\radius
    \pgf@x=0pt%
    \pgf@y=-\pgf@y%
    \advance\pgf@y by -0.2\pgfutil@tempdima
  }
  % Draw the rectangle box and the port labels
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}
    \pgfutil@tempdima=\radius
    \pgf@anchor@dffx@PR
    \advance\pgf@y by 0.1\pgfutil@tempdima
    \pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{0.1\pgfutil@tempdima}
    \pgf@anchor@dffx@CLR
    \advance\pgf@y by -0.1\pgfutil@tempdima
    \pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{0.1\pgfutil@tempdima}
    % Angle (>) for clock input
    \pgf@anchor@dffx@Clk
    \pgf@xa=\pgf@x \pgf@ya=\pgf@y
    \pgf@xb=\pgf@x \pgf@yb=\pgf@y
    \pgf@xc=\pgf@x \pgf@yc=\pgf@y
    \pgfmathsetlength\pgf@x{1.6ex} % size depends on font size
    \advance\pgf@ya by \pgf@x
    \advance\pgf@xb by \pgf@x
    \advance\pgf@yc by -\pgf@x
    \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
    \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
    \pgfclosepath

    % Draw port labels
    \begingroup
    \tikzset{flip flop/port labels} % Use font from this style
    \tikz@textfont

    \pgf@anchor@tffx@Q
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Q}}

    \pgf@anchor@tffx@Qn
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{$\overline{\mbox{Q}}$}}

    \pgf@anchor@tffx@T
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{T}}

    \pgf@anchor@tffx@Clk
    \pgftext[left,base,at={\pgfpoint{\pgf@xb}{\pgf@yb}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Clk}}

    \pgf@anchor@tffx@PR
    \pgftext[top,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{PR}

    \pgf@anchor@tffx@CLR
    \pgftext[bottom,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep]{CLR}
    \endgroup
  }
}

\pgfdeclareshape{dffxn}{
  % The 'minimum width' and 'minimum height' keys, not the content, determine
  % the size
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  % This is redundant, but makes some things easier:
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \saveddimen\radius{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=.5\pgf@xb%
    \pgf@x=.5\pgf@yb%
  }
  % Inherit from rectangle
  \inheritanchorborder[from=rectangle]

  % Define same anchor a normal rectangle has
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }

  % Define anchors for signal ports
  \anchor{D}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Clk}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=-.5\pgf@y%
  }
  \anchor{Q}{
    \pgf@process{\northeast}%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Qn}{
    \pgf@process{\northeast}%
    \pgf@y=-.5\pgf@y%
  }
  \anchor{PR}{
    \pgf@process{\northeast}%
    \pgfutil@tempdima=\radius
    \pgf@x=0pt%
    \advance\pgf@y by 0.2\pgfutil@tempdima
  }
  \anchor{CLR}{
    \pgf@process{\northeast}%
    \pgfutil@tempdima=\radius
    \pgf@x=0pt%
    \pgf@y=-\pgf@y%
    \advance\pgf@y by -0.2\pgfutil@tempdima
  }
  % Draw the rectangle box and the port labels
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}
    \pgfutil@tempdima=\radius
    \pgf@anchor@dffx@PR
    \advance\pgf@y by 0.1\pgfutil@tempdima
    \pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{0.1\pgfutil@tempdima}
    \pgf@anchor@dffx@CLR
    \advance\pgf@y by -0.1\pgfutil@tempdima
    \pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{0.1\pgfutil@tempdima}
    % Angle (>) for clock input
    \pgf@anchor@dffx@Clk
    \pgf@xa=\pgf@x \pgf@ya=\pgf@y
    \pgf@xb=\pgf@x \pgf@yb=\pgf@y
    \pgf@xc=\pgf@x \pgf@yc=\pgf@y
    \pgfmathsetlength\pgf@x{1.6ex} % size depends on font size
    \advance\pgf@ya by \pgf@x
    \advance\pgf@xb by \pgf@x
    \advance\pgf@yc by -\pgf@x
    \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
    \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
    \pgfclosepath

    % Draw port labels
    \begingroup
    \tikzset{flip flop/port labels} % Use font from this style
    \tikz@textfont

    \pgf@anchor@dffx@D
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{D}}

    \pgf@anchor@dffx@Q
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Q}}

    \pgf@anchor@dffx@Qn
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{$\overline{\mbox{Q}}$}}

    \pgf@anchor@dffxn@Clk
    \pgftext[left,base,at={\pgfpoint{\pgf@xb}{\pgf@yb}},x=\pgfshapeinnerxsep]{\raisebox{-.75ex}{Clk}}

    \pgf@anchor@dffx@PR
    \pgftext[top,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{PR}

    \pgf@anchor@dffx@CLR
    \pgftext[bottom,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep]{CLR}
    \endgroup
  }
}

\pgfdeclareshape{jkffx}{
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \inheritanchorborder[from=rectangle]
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }
  \anchor{Q}{
    \pgf@process{\northeast}%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Qn}{
    \pgf@process{\northeast}%
    \pgf@y=-.5\pgf@y%
  }
  \anchor{K}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=-0.5\pgf@y%
  }
  \anchor{Clk}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=0pt%
  }
  \anchor{J}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=0.5\pgf@y%
  }
  \anchor{PR}{
    \pgf@process{\northeast}%
    \pgf@x=0pt%
  }
  \anchor{CLR}{
    \pgf@process{\northeast}%
    \pgf@x=0pt%
    \pgf@y=-\pgf@y%
  }
  % Draw the rectangle box and the port labels
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}
    % Angle (>) for clock input
    \pgf@anchor@jkffx@Clk
    \pgf@xa=\pgf@x \pgf@ya=\pgf@y
    \pgf@xb=\pgf@x \pgf@yb=\pgf@y
    \pgf@xc=\pgf@x \pgf@yc=\pgf@y
    \pgfmathsetlength\pgf@x{1.6ex} % size depends on font size
    \advance\pgf@ya by \pgf@x
    \advance\pgf@xb by \pgf@x
    \advance\pgf@yc by -\pgf@x
    \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
    \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
    \pgfclosepath

    % Draw port labels
    \begingroup
    \tikzset{flip flop/port labels} % Use font from this style
    \tikz@textfont

    \pgf@anchor@jkffx@Q
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Q}}

    \pgf@anchor@jkffx@Qn
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{$\overline{\mbox{Q}}$}}

    \pgf@anchor@jkffx@K
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{K}}

    \pgf@anchor@jkffx@Clk
    \pgftext[left,base,at={\pgfpoint{\pgf@xb}{\pgf@yb}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Clk}}

    \pgf@anchor@jkffx@J
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{J}}

    \pgf@anchor@jkffx@PR
    \pgftext[top,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{PR}

    \pgf@anchor@jkffx@CLR
    \pgftext[bottom,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep]{CLR}
    \endgroup
  }
}

\pgfdeclareshape{jkffxn}{
  % The 'minimum width' and 'minimum height' keys, not the content, determine
  % the size
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  % This is redundant, but makes some things easier:
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \saveddimen\radius{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=.5\pgf@xb%
    \pgf@x=.5\pgf@yb%
  }
  % Inherit from rectangle
  \inheritanchorborder[from=rectangle]

  % Define same anchor a normal rectangle has
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }

  % Define anchors for signal ports
  \anchor{Q}{
    \pgf@process{\northeast}%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Qn}{
    \pgf@process{\northeast}%
    \pgf@y=-.5\pgf@y%
  }
  \anchor{K}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=-0.5\pgf@y%
  }
  \anchor{Clk}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=0pt%
  }
  \anchor{J}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=0.5\pgf@y%
  }
  \anchor{PR}{
    \pgf@process{\northeast}%
    \pgfutil@tempdima=\radius
    \pgf@x=0pt%
    \advance\pgf@y by 0.2\pgfutil@tempdima
  }
  \anchor{CLR}{
    \pgf@process{\northeast}%
    \pgfutil@tempdima=\radius
    \pgf@x=0pt%
    \pgf@y=-\pgf@y%
    \advance\pgf@y by -0.2\pgfutil@tempdima
  }
  % Draw the rectangle box and the port labels
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}
    \pgfutil@tempdima=\radius
    \pgf@anchor@dffx@PR
    \advance\pgf@y by 0.1\pgfutil@tempdima
    \pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{0.1\pgfutil@tempdima}
    \pgf@anchor@dffx@CLR
    \advance\pgf@y by -0.1\pgfutil@tempdima
    \pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{0.1\pgfutil@tempdima}
    % Angle (>) for clock input
    \pgf@anchor@jkffxn@Clk
    \pgf@xa=\pgf@x \pgf@ya=\pgf@y
    \pgf@xb=\pgf@x \pgf@yb=\pgf@y
    \pgf@xc=\pgf@x \pgf@yc=\pgf@y
    \pgfmathsetlength\pgf@x{1.6ex} % size depends on font size
    \advance\pgf@ya by \pgf@x
    \advance\pgf@xb by \pgf@x
    \advance\pgf@yc by -\pgf@x
    \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
    \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
    \pgfclosepath

    % Draw port labels
    \begingroup
    \tikzset{flip flop/port labels} % Use font from this style
    \tikz@textfont

    \pgf@anchor@jkffx@Q
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Q}}

    \pgf@anchor@jkffx@Qn
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{$\overline{\mbox{Q}}$}}

    \pgf@anchor@jkffxn@J
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{J}}

    \pgf@anchor@jkffx@Clk
    \pgftext[left,base,at={\pgfpoint{\pgf@xb}{\pgf@yb}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Clk}}

    \pgf@anchor@jkffxn@K
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{K}}

    \pgf@anchor@jkffx@PR
    \pgftext[top,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{PR}

    \pgf@anchor@jkffx@CLR
    \pgftext[bottom,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep]{CLR}
    \endgroup
  }
}

\pgfdeclareshape{regd}{
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  \saveddimen\radius{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=.5\pgf@xb%
    \pgf@x=.5\pgf@yb%
  }
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \inheritanchorborder[from=rectangle]
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }
  \anchor{PR}{
    \pgf@process{\northeast}%
    \pgf@y=.5\pgf@y%
    \pgfutil@tempdima=\radius
    \advance\pgf@x by .2\pgfutil@tempdima
  }
  \anchor{Q3}{
    \pgf@process{\northeast}%
    \pgf@y=-1\pgf@y%
    \pgf@x=-.6\pgf@x
  }
  \anchor{Q2}{
    \pgf@process{\northeast}%
    \pgf@y=-1\pgf@y%
    \pgf@x=-.2\pgf@x
  }
  \anchor{Q1}{
    \pgf@process{\northeast}%
    \pgf@y=-1\pgf@y%
    \pgf@x=.2\pgf@x
  }
  \anchor{Q0}{
    \pgf@process{\northeast}%
    \pgf@y=-1\pgf@y%
    \pgf@x=.6\pgf@x
  }
  \anchor{D3}{
    \pgf@process{\northeast}%
    \pgf@x=-.6\pgf@x
  }
  \anchor{D2}{
    \pgf@process{\northeast}%
    \pgf@x=-.2\pgf@x
  }
  \anchor{D1}{
    \pgf@process{\northeast}%
    \pgf@x=.2\pgf@x
  }
  \anchor{D0}{
    \pgf@process{\northeast}%
    \pgf@x=.6\pgf@x
  }
  \anchor{CLR}{
    \pgf@process{\northeast}%
    \pgf@y=-.5\pgf@y%
    \pgfutil@tempdima=\radius
    \advance\pgf@x by .2\pgfutil@tempdima
  }
  \anchor{LD}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=.5\pgf@y%
  }
  \anchor{Clk}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=-.5\pgf@y%
  }
  % Draw the rectangle box and the port labels
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}
    \pgfutil@tempdima=\radius
    \pgf@anchor@regd@PR
    \advance\pgf@x by -0.1\pgfutil@tempdima
    \pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{0.1\pgfutil@tempdima}
    \pgf@anchor@regd@CLR
    \advance\pgf@x by -0.1\pgfutil@tempdima
    \pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{0.1\pgfutil@tempdima}
    % Angle (>) for clock input
    \pgf@anchor@regd@Clk
    \pgf@xa=\pgf@x \pgf@ya=\pgf@y
    \pgf@xb=\pgf@x \pgf@yb=\pgf@y
    \pgf@xc=\pgf@x \pgf@yc=\pgf@y
    \pgfmathsetlength\pgf@x{1.6ex} % size depends on font size
    \advance\pgf@ya by \pgf@x
    \advance\pgf@xb by \pgf@x
    \advance\pgf@yc by -\pgf@x
    \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
    \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
    \pgfclosepath

    % Draw port labels
    \begingroup
    \tikzset{flip flop/port labels} % Use font from this style
    \tikz@textfont

    \pgf@anchor@regd@PR
    \advance\pgf@x by -0.2\pgfutil@tempdima
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Pr}}

    \pgf@anchor@regd@CLR
    \advance\pgf@x by -0.2\pgfutil@tempdima
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{Clr}}

    \pgf@anchor@regd@Clk
    \pgftext[left,base,at={\pgfpoint{\pgf@xb}{\pgf@yb}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Clk}}

    \pgf@anchor@regd@LD
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{LD}}
    \endgroup
  }
}

\pgfdeclareshape{regi}{
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \inheritanchorborder[from=rectangle]
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }
  \anchor{PR}{
    \pgf@process{\northeast}%
    \pgf@y=.5\pgf@y%
    \pgfutil@tempdima=\radius
    \advance\pgf@x by .2\pgfutil@tempdima
  }
  \anchor{Q}{
    \pgf@process{\northeast}%
    \pgf@y=-1\pgf@y%
    \pgf@x=0\pgf@x
  }
  \anchor{D}{
    \pgf@process{\northeast}%
    \pgf@x=0\pgf@x
  }
  \anchor{CLR}{
    \pgf@process{\northeast}%
    \pgf@y=0.3333\pgf@y%
    \pgf@x=-\pgf@x
  }
  \anchor{LDB}{
    \pgf@process{\northeast}%
    \pgf@x=-\pgf@x%
    \pgf@y=-0.3333\pgf@y%
  }
  \anchor{LDM}{
    \pgf@process{\northeast}%
    \pgf@x=-\pgf@x%
    \pgf@y=0\pgf@y%
  }
  \anchor{Clk}{
    \pgf@process{\northeast}%
    \pgf@x=-0.6666\pgf@x%
    \pgf@y=-1\pgf@y%
  }
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}
    % Angle (>) for clock input
    \pgf@anchor@regi@Clk
    \pgf@xa=\pgf@x \pgf@ya=\pgf@y
    \pgf@xb=\pgf@x \pgf@yb=\pgf@y
    \pgf@xc=\pgf@x \pgf@yc=\pgf@y
    \pgfmathsetlength\pgf@y{1ex} % size depends on font size
    \advance\pgf@xa by 0.5\pgf@y
    \advance\pgf@yb by \pgf@y
    \advance\pgf@xc by -0.5\pgf@y
    \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
    \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
    \pgfclosepath

    % Draw port labels
    \begingroup
    \tikzset{flip flop/port labels} % Use font from this style
    \tikz@textfont

    \pgf@anchor@regi@CLR
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-.75ex}{R}}
    \endgroup
  }
}

\pgfdeclareshape{counterdir}{
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \inheritanchorborder[from=rectangle]
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }
  \anchor{Qi}{
    \pgf@process{\northeast}%
    \pgf@x = 0\pgf@x
    \pgf@y=-\pgf@y%
  }
  \anchor{Dir}{
    \pgf@process{\northeast}%
    \pgf@x = 0\pgf@x
  }
  \anchor{Eii}{
    \pgf@process{\northeast}%
    \pgf@y=0.333\pgf@y
  }
  \anchor{Ei}{
    \pgf@process{\northeast}%
    \pgf@y=0.333\pgf@y
    \pgf@x=-\pgf@x
  }
  \anchor{Di}{
    \pgf@process{\northeast}%
    \pgf@y=-0.333\pgf@y
    \pgf@x=-\pgf@x
  }
  % Draw the rectangle box and the port labels
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}

    % Draw port labels
    \begingroup
    \tikzset{flip flop/port labels} % Use font from this style
    \tikz@textfont

    \pgf@anchor@counterdir@Dir
    \pgftext[top,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep]{Dir}

    \pgf@anchor@counterdir@Qi
    \pgftext[bottom,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep]{Q$_i$}

    \pgf@anchor@counterdir@Di
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{D$_i$}}

    \pgf@anchor@counterdir@Ei
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{E$_i$}}

    \pgf@anchor@counterdir@Eii
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{E$_{i+1}$}}
    \endgroup
  }
}
\pgfdeclareshape{counterdbit}{
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  \saveddimen\radius{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=.5\pgf@xb%
    \pgf@x=.5\pgf@yb%
  }
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \inheritanchorborder[from=rectangle]
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }
  \anchor{D3}{
    \pgf@process{\northeast}%
    \pgf@x = -0.4286\pgf@x
  }
  \anchor{D2}{
    \pgf@process{\northeast}%
    \pgf@x = -0.14286\pgf@x
  }
  \anchor{D1}{
    \pgf@process{\northeast}%
    \pgf@x = 0.14286\pgf@x
  }
  \anchor{D0}{
    \pgf@process{\northeast}%
    \pgf@x = 0.4286\pgf@x
  }
  \anchor{Q3}{
    \pgf@process{\northeast}%
    \pgf@x = -0.4286\pgf@x
    \pgf@y = -1\pgf@y
  }
  \anchor{Q2}{
    \pgf@process{\northeast}%
    \pgf@x = -0.14286\pgf@x
    \pgf@y = -1\pgf@y
  }
  \anchor{Q1}{
    \pgf@process{\northeast}%
    \pgf@x = 0.14286\pgf@x
    \pgf@y = -1\pgf@y
  }
  \anchor{Q0}{
    \pgf@process{\northeast}%
    \pgf@x = 0.4286\pgf@x
    \pgf@y = -1\pgf@y
  }
  \anchor{Clk}{
    \pgf@process{\northeast}%
    \pgf@x = -1\pgf@x
    \pgf@y = 0\pgf@y
  }
  \anchor{LD}{
    \pgf@process{\northeast}%
    \pgfutil@tempdima=\radius
    \pgf@x = -1\pgf@x
    \pgf@y = -0.3333\pgf@y
  }
  \anchor{CLR}{
    \pgf@process{\northeast}%
    \pgfutil@tempdima=\radius
    \pgf@x = -1\pgf@x
    \advance\pgf@x by -.2\pgfutil@tempdima
    \pgf@y = -0.6666\pgf@y
  }
  \anchor{DU}{
    \pgf@process{\northeast}%
    \pgf@x = -1\pgf@x
    \pgf@y = 0.6666\pgf@y
  }
  \anchor{CEIN}{
    \pgf@process{\northeast}%
    \pgf@x = -1\pgf@x
    \pgf@y = 0.3333\pgf@y
  }
  \anchor{CEOUT}{
    \pgf@process{\northeast}%
    \pgf@y = 0.3333\pgf@y
  }
  % Draw the rectangle box and the port labels
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}
    \pgfutil@tempdima=\radius
    \pgf@anchor@counterdbit@CLR
    \advance\pgf@x by 0.1\pgfutil@tempdima
    \pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{0.1\pgfutil@tempdima}
    \pgf@anchor@counterdbit@Clk
    \pgf@xa=\pgf@x \pgf@ya=\pgf@y
    \pgf@xb=\pgf@x \pgf@yb=\pgf@y
    \pgf@xc=\pgf@x \pgf@yc=\pgf@y
    \pgfmathsetlength\pgf@x{1.6ex} % size depends on font size
    \advance\pgf@ya by \pgf@x
    \advance\pgf@xb by \pgf@x
    \advance\pgf@yc by -\pgf@x
    \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
    \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
    \pgfclosepath

    % Draw port labels
    \begingroup
    \tikzset{flip flop/port labels} % Use font from this style
    \tikz@textfont

    \pgf@anchor@counterdbit@LD
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{LD}}
    \pgf@anchor@counterdbit@CEIN
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{$\mbox{CE}_{\mbox{\tiny{in}}}$}}
    \pgf@anchor@counterdbit@DU
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{D/U$^*$}}
    \pgf@anchor@counterdbit@Clk
    \pgftext[left,base,at={\pgfpoint{\pgf@xb}{\pgf@yb}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Clk}}
    \pgf@anchor@counterdbit@CLR
    \advance\pgf@x by 0.2\pgfutil@tempdima
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{CLR}}
    \pgf@anchor@counterdbit@CEOUT
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{$\mbox{CE}_{\mbox{\tiny{out}}}$}}

    \endgroup
  }
}
\pgfdeclareshape{counterdbitrev}{
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  \saveddimen\radius{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=.5\pgf@xb%
    \pgf@x=.5\pgf@yb%
  }
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \inheritanchorborder[from=rectangle]
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }
  \anchor{D3}{
    \pgf@process{\northeast}%
    \pgf@x = -0.4286\pgf@x
  }
  \anchor{D2}{
    \pgf@process{\northeast}%
    \pgf@x = -0.14286\pgf@x
  }
  \anchor{D1}{
    \pgf@process{\northeast}%
    \pgf@x = 0.14286\pgf@x
  }
  \anchor{D0}{
    \pgf@process{\northeast}%
    \pgf@x = 0.4286\pgf@x
  }
  \anchor{Q3}{
    \pgf@process{\northeast}%
    \pgf@x = -0.4286\pgf@x
    \pgf@y = -1\pgf@y
  }
  \anchor{Q2}{
    \pgf@process{\northeast}%
    \pgf@x = -0.14286\pgf@x
    \pgf@y = -1\pgf@y
  }
  \anchor{Q1}{
    \pgf@process{\northeast}%
    \pgf@x = 0.14286\pgf@x
    \pgf@y = -1\pgf@y
  }
  \anchor{Q0}{
    \pgf@process{\northeast}%
    \pgf@x = 0.4286\pgf@x
    \pgf@y = -1\pgf@y
  }
  \anchor{Clk}{
    \pgf@process{\northeast}%
    \pgf@x = -1\pgf@x
    \pgf@y = 0\pgf@y
  }
  \anchor{LD}{
    \pgf@process{\northeast}%
    \pgfutil@tempdima=\radius
    \pgf@x = -1\pgf@x
    \pgf@y = -0.3333\pgf@y
  }
  \anchor{CLR}{
    \pgf@process{\northeast}%
    \pgfutil@tempdima=\radius
    \pgf@x = -1\pgf@x
    \advance\pgf@x by -.2\pgfutil@tempdima
    \pgf@y = -0.6666\pgf@y
  }
  \anchor{DU}{
    \pgf@process{\northeast}%
    \pgf@x = -1\pgf@x
    \pgf@y = 0.6666\pgf@y
  }
  \anchor{CEIN}{
    \pgf@process{\northeast}%
    \pgf@x = -1\pgf@x
    \pgf@y = 0.3333\pgf@y
  }
  \anchor{CEOUT}{
    \pgf@process{\northeast}%
    \pgf@y = 0.3333\pgf@y
  }
  % Draw the rectangle box and the port labels
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}
    \pgfutil@tempdima=\radius
    \pgf@anchor@counterdbit@CLR
    \advance\pgf@x by 0.1\pgfutil@tempdima
    \pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{0.1\pgfutil@tempdima}
    \pgf@anchor@counterdbit@Clk
    \pgf@xa=\pgf@x \pgf@ya=\pgf@y
    \pgf@xb=\pgf@x \pgf@yb=\pgf@y
    \pgf@xc=\pgf@x \pgf@yc=\pgf@y
    \pgfmathsetlength\pgf@x{1.6ex} % size depends on font size
    \advance\pgf@ya by \pgf@x
    \advance\pgf@xb by \pgf@x
    \advance\pgf@yc by -\pgf@x
    \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
    \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
    \pgfclosepath

    % Draw port labels
    \begingroup
    \tikzset{flip flop/port labels} % Use font from this style
    \tikz@textfont

    \pgf@anchor@counterdbit@LD
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{LD}}
    \pgf@anchor@counterdbit@CEIN
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{$\mbox{CE}_{\mbox{\tiny{in}}}$}}
    \pgf@anchor@counterdbit@DU
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{U/D$^*$}}
    \pgf@anchor@counterdbit@Clk
    \pgftext[left,base,at={\pgfpoint{\pgf@xb}{\pgf@yb}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Clk}}
    \pgf@anchor@counterdbit@CLR
    \advance\pgf@x by 0.2\pgfutil@tempdima
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{CLR}}
    \pgf@anchor@counterdbit@CEOUT
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{$\mbox{CE}_{\mbox{\tiny{out}}}$}}

    \endgroup
  }
}
\pgfdeclareshape{upcounterdbit}{
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  \saveddimen\radius{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=.5\pgf@xb%
    \pgf@x=.5\pgf@yb%
  }
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \inheritanchorborder[from=rectangle]
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }
  \anchor{D3}{
    \pgf@process{\northeast}%
    \pgf@x = -0.4286\pgf@x
  }
  \anchor{D2}{
    \pgf@process{\northeast}%
    \pgf@x = -0.14286\pgf@x
  }
  \anchor{D1}{
    \pgf@process{\northeast}%
    \pgf@x = 0.14286\pgf@x
  }
  \anchor{D0}{
    \pgf@process{\northeast}%
    \pgf@x = 0.4286\pgf@x
  }
  \anchor{Q3}{
    \pgf@process{\northeast}%
    \pgf@x = -0.4286\pgf@x
    \pgf@y = -1\pgf@y
  }
  \anchor{Q2}{
    \pgf@process{\northeast}%
    \pgf@x = -0.14286\pgf@x
    \pgf@y = -1\pgf@y
  }
  \anchor{Q1}{
    \pgf@process{\northeast}%
    \pgf@x = 0.14286\pgf@x
    \pgf@y = -1\pgf@y
  }
  \anchor{Q0}{
    \pgf@process{\northeast}%
    \pgf@x = 0.4286\pgf@x
    \pgf@y = -1\pgf@y
  }
  \anchor{Clk}{
    \pgf@process{\northeast}%
    \pgf@x = -1\pgf@x
    \pgf@y = -0.6666\pgf@y
  }
  \anchor{CLR}{
    \pgf@process{\northeast}%
    \pgfutil@tempdima=\radius
    \pgf@x = -1\pgf@x
    \advance\pgf@x by -.2\pgfutil@tempdima
    \pgf@y = 0.6666\pgf@y
  }
  \anchor{CEIN}{
    \pgf@process{\northeast}%
    \pgf@x = -1\pgf@x
    \pgf@y = 0\pgf@y
  }
  % Draw the rectangle box and the port labels
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}
    \pgfutil@tempdima=\radius
    \pgf@anchor@upcounterdbit@CLR
    \advance\pgf@x by 0.1\pgfutil@tempdima
    \pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{0.1\pgfutil@tempdima}
    \pgf@anchor@upcounterdbit@Clk
    \pgf@xa=\pgf@x \pgf@ya=\pgf@y
    \pgf@xb=\pgf@x \pgf@yb=\pgf@y
    \pgf@xc=\pgf@x \pgf@yc=\pgf@y
    \pgfmathsetlength\pgf@x{1.6ex} % size depends on font size
    \advance\pgf@ya by \pgf@x
    \advance\pgf@xb by \pgf@x
    \advance\pgf@yc by -\pgf@x
    \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
    \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
    \pgfclosepath

    % Draw port labels
    \begingroup
    \tikzset{flip flop/port labels} % Use font from this style
    \tikz@textfont

    \pgf@anchor@upcounterdbit@CEIN
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{$\mbox{CE}_{\mbox{\tiny{in}}}$}}
    \pgf@anchor@upcounterdbit@Clk
    \pgftext[left,base,at={\pgfpoint{\pgf@xb}{\pgf@yb}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{Clk}}
    \pgf@anchor@upcounterdbit@CLR
    \advance\pgf@x by 0.2\pgfutil@tempdima
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{CLR}}

    \endgroup
  }
}
\pgfdeclareshape{transgate} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }
  \saveddimen\radius{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=.5\pgf@xb%
    \pgf@x=.5\pgf@yb%
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{cn}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@y by 0.5\pgfutil@tempdima\pgfutil@tempdima=\radius\advance\pgf@y by 0.4\pgfutil@tempdima}
  \anchor{c}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@y by -0.5\pgfutil@tempdima}
  \anchor{x}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{z}{\centerpoint\advance\pgf@x by\halfwidth}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}

  \backgroundpath{
     \pgfutil@tempdima=\halfwidth
     \centerpoint
     \advance\pgf@x by \halfwidth
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
%      \centerpoint
%      \pgfutil@tempda=\halfheight
%      \pgfutil@tempdima=\radius
%      \advance\pgf@y by 0.5\pgfutil@tempda
%      \advance\pgf@y by 0.088888\pgfutil@tempdima
%      \pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{0.166667\pgfutil@tempdima}
    \pgfutil@tempdima=\radius
    \pgfutil@tempdimb=\halfheight
    \centerpoint
    \advance\pgf@y by 0.5\pgfutil@tempdimb
    \advance\pgf@y by 0.2\pgfutil@tempdima
    \pgfpathcircle{\pgfpoint{\pgf@x}{\pgf@y}}{0.2\pgfutil@tempdima}
  }
}

\pgfdeclareshape{asmN} {

  \inheritsavedanchors[from=rectangle] % this is nearly a rectangle
  \inheritanchorborder[from=rectangle]
  \inheritanchor[from=rectangle]{north}
  \inheritanchor[from=rectangle]{north west}
  \inheritanchor[from=rectangle]{north east}
  \inheritanchor[from=rectangle]{center}
  \inheritanchor[from=rectangle]{west}
  \inheritanchor[from=rectangle]{east}
  \inheritanchor[from=rectangle]{mid}
  \inheritanchor[from=rectangle]{mid west}
  \inheritanchor[from=rectangle]{mid east}
  \inheritanchor[from=rectangle]{base}
  \inheritanchor[from=rectangle]{base west}
  \inheritanchor[from=rectangle]{base east}
  \inheritanchor[from=rectangle]{south}
  \inheritanchor[from=rectangle]{south west}
  \inheritanchor[from=rectangle]{south east}

  \backgroundpath{
    \southwest \pgf@xa=\pgf@x \pgf@ya=\pgf@y \pgf@yc=\pgf@x
    \northeast \pgf@xb=\pgf@x \pgf@yb=\pgf@y
    \pgf@yc=-0.75\pgf@yc
    \pgf@xc=\pgf@xb \advance\pgf@xc by -\pgf@yc
    \pgf@yc=-\pgf@yc \advance\pgf@yc by \pgf@yb
    \pgfpathmoveto{\pgfqpoint{\pgf@xa}{\pgf@ya}}
    \pgfpathlineto{\pgfqpoint{\pgf@xa}{\pgf@yb}}
    \pgfpathlineto{\pgfqpoint{\pgf@xc}{\pgf@yb}}
    \pgfpathlineto{\pgfqpoint{\pgf@xb}{\pgf@yc}}
    \pgfpathlineto{\pgfqpoint{\pgf@xb}{\pgf@ya}}
    \pgfpathclose
    \pgfpathmoveto{\pgfqpoint{\pgf@xc}{\pgf@yb}}
    \pgfpathlineto{\pgfqpoint{\pgf@xc}{\pgf@yc}}
    \pgfpathlineto{\pgfqpoint{\pgf@xb}{\pgf@yc}}
  }

}

\pgfdeclareshape{rfcbb} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}
  \anchor{web}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.3333\pgfutil@tempdima}
  \anchor{wea}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.3333\pgfutil@tempdima}
  \anchor{rea}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by-0.3333\pgfutil@tempdima}
  \anchor{reb}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by0.3333\pgfutil@tempdima}
  \anchor{dina}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@x by-\halfwidth\advance\pgf@y by0.3333\pgfutil@tempdima}
  \anchor{dinb}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@x by-\halfwidth\advance\pgf@y by-0.3333\pgfutil@tempdima}
  \anchor{douta}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@x by\halfwidth\advance\pgf@y by0.3333\pgfutil@tempdima}
  \anchor{doutb}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@x by\halfwidth\advance\pgf@y by-0.3333\pgfutil@tempdima}

  \backgroundpath{
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
  }
  
}
\pgfdeclareshape{rfcbc} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}
  \anchor{web}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.3333\pgfutil@tempdima}
  \anchor{wea}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.3333\pgfutil@tempdima}
  \anchor{rea}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by-0.5\pgfutil@tempdima}
  \anchor{reb}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight}
  \anchor{rec}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by0.5\pgfutil@tempdima}
  \anchor{dina}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@x by-\halfwidth\advance\pgf@y by0.3333\pgfutil@tempdima}
  \anchor{dinb}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@x by-\halfwidth\advance\pgf@y by-0.3333\pgfutil@tempdima}
  \anchor{douta}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@x by\halfwidth\advance\pgf@y by0.5\pgfutil@tempdima}
  \anchor{doutb}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@x by\halfwidth}
  \anchor{doutc}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@x by\halfwidth\advance\pgf@y by-0.5\pgfutil@tempdima}

  \backgroundpath{
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
  }
  
}

\pgfdeclareshape{ramm}{
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \inheritanchorborder[from=rectangle]
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }
  \anchor{A}{
    \pgf@process{\northeast}%
    \pgf@y=.5\pgf@y%
    \pgf@x=-\pgf@x%
  }
  \anchor{CS}{
    \pgf@process{\northeast}%
    \pgf@y=0\pgf@y%
    \pgf@x=-\pgf@x%
  }
  \anchor{RW}{
    \pgf@process{\northeast}%
    \pgf@y=-.5\pgf@y%
    \pgf@x=-\pgf@x%
  }
  \anchor{D}{
    \pgf@process{\northeast}%
    \pgf@y=0\pgf@y%
  }
  
  % Draw the rectangle box and the port labels
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}
    \pgfclosepath

    % Draw port labels
    \begingroup
    \tikzset{flip flop/port labels} % Use font from this style
    \tikz@textfont

    \pgf@anchor@ramm@D
    \pgftext[right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=-\pgfshapeinnerxsep]{\raisebox{-.75ex}{D}}

    \pgf@anchor@ramm@A
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{A}}

    \pgf@anchor@ramm@CS
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{CS}}

    \pgf@anchor@ramm@RW
    \pgftext[left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},x=\pgfshapeinnerxsep]{\raisebox{-0.75ex}{$\mbox{R/W}^*$}}
    \endgroup
  }
}

\pgfdeclareshape{triplefive} {

  \savedanchor\centerpoint{
    \pgf@x=.5\wd\pgfnodeparttextbox
    \pgf@y=.5\ht\pgfnodeparttextbox
    \advance\pgf@y by-.5\dp\pgfnodeparttextbox
  } 
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }

  \anchor{center}{\centerpoint}
  \anchor{mid}{\centerpoint\pgfmathsetlength\pgf@y{.5ex}}
  \anchor{base}{\centerpoint\pgf@y=0pt}
  \anchor{north}{\centerpoint\advance\pgf@y by\halfheight}
  \anchor{output}{\centerpoint\advance\pgf@x by\halfwidth}
  \anchor{supply}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by-0.333\pgfutil@tempdima}
  \anchor{reset}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by\halfheight\advance\pgf@x by0.333\pgfutil@tempdima}
  \anchor{ground}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by-0.333\pgfutil@tempdima}
  \anchor{control}{\centerpoint\pgfutil@tempdima=\halfwidth\advance\pgf@y by-\halfheight\advance\pgf@x by0.333\pgfutil@tempdima}
  \anchor{discharge}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@y by0.5\pgfutil@tempdima\advance\pgf@x by-\halfwidth}
  \anchor{threshold}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@y by0.0\pgfutil@tempdima\advance\pgf@x by-\halfwidth}
  \anchor{trigger}{\centerpoint\pgfutil@tempdima=\halfheight\advance\pgf@y by-0.5\pgfutil@tempdima\advance\pgf@x by-\halfwidth}
  \anchor{gnd}{\pgf@anchor@triplefive@ground}
  \anchor{vcc}{\pgf@anchor@triplefive@supply}
  \anchor{pin1}{\pgf@anchor@triplefive@ground}
  \anchor{pin2}{\pgf@anchor@triplefive@trigger}
  \anchor{pin3}{\pgf@anchor@triplefive@output}
  \anchor{pin4}{\pgf@anchor@triplefive@reset}
  \anchor{pin5}{\pgf@anchor@triplefive@control}
  \anchor{pin6}{\pgf@anchor@triplefive@threshold}
  \anchor{pin7}{\pgf@anchor@triplefive@discharge}
  \anchor{pin8}{\pgf@anchor@triplefive@supply}
  \anchor{south}{\centerpoint\advance\pgf@y by-\halfheight}
  \anchor{west}{\centerpoint\advance\pgf@x by-\halfwidth}
  \anchor{east}{\centerpoint\advance\pgf@x by\halfwidth}

  \backgroundpath{
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathmoveto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by \halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by -\halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \centerpoint
     \advance\pgf@x by -\halfwidth
     \advance\pgf@y by \halfheight
     \pgfpathlineto{\pgfpoint{\pgf@x}{\pgf@y}}
     \pgfpathclose
     \begingroup
     \tikzset{port labels}
     \tikz@textfont
     \pgf@anchor@triplefive@ground
     \pgftext[top,right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep,x=-\pgfshapeinnerxsep]{\raisebox{-1.25ex}{1}}
     \pgf@anchor@triplefive@control
     \pgftext[top,left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep,x=\pgfshapeinnerxsep]{\raisebox{-1.25ex}{5}}
     \pgf@anchor@triplefive@supply
     \pgftext[bottom,right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep,x=-\pgfshapeinnerxsep]{\raisebox{0.0ex}{8}}
     \pgf@anchor@triplefive@reset
     \pgftext[bottom,left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep,x=\pgfshapeinnerxsep]{\raisebox{0.0ex}{4}}
     \pgf@anchor@triplefive@output
     \pgftext[bottom,left,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep,x=\pgfshapeinnerxsep]{\raisebox{0.0ex}{3}}
     \pgf@anchor@triplefive@discharge
     \pgftext[bottom,right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep,x=-\pgfshapeinnerxsep]{\raisebox{0.0ex}{7}}
     \pgf@anchor@triplefive@threshold
     \pgftext[bottom,right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=\pgfshapeinnerysep,x=-\pgfshapeinnerxsep]{\raisebox{0.0ex}{6}}
     \pgf@anchor@triplefive@trigger
     \pgftext[top,right,base,at={\pgfpoint{\pgf@x}{\pgf@y}},y=-\pgfshapeinnerysep,x=-\pgfshapeinnerxsep]{\raisebox{-1.25ex}{2}}
     \endgroup
  }
}

\pgfdeclareshape{fununit}{
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \saveddimen\halfwidth{%
    \pgfmathsetlength{\pgf@xb}{\pgfkeysvalueof{/pgf/minimum width}}%  
    \pgf@x=0.5\pgf@xb
  }
  \saveddimen\halfheight{
    \pgfmathsetlength{\pgf@yb}{\pgfkeysvalueof{/pgf/minimum height}}%  
    \pgf@x=0.5\pgf@yb
  }
  \inheritanchorborder[from=rectangle]
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }
  \anchor{output}{\southwest \pgf@x=0pt}
  \anchor{inputaa}{\northeast \pgf@x=0pt}
  \anchor{inputba}{\northeast \pgfutil@tempdima=\halfwidth\advance\pgf@x by -1.333\pgfutil@tempdima}
  \anchor{inputbb}{\northeast \pgfutil@tempdima=\halfwidth\advance\pgf@x by -0.667\pgfutil@tempdima}
  \anchor{inputca}{\northeast \pgfutil@tempdima=\halfwidth\advance\pgf@x by -1.25\pgfutil@tempdima}
  \anchor{inputcb}{\northeast \pgf@x=0pt}
  \anchor{inputcc}{\northeast \pgfutil@tempdima=\halfwidth\advance\pgf@x by 0.75\pgfutil@tempdima}
  \anchor{inputda}{\northeast \pgfutil@tempdima=\halfwidth\advance\pgf@x by -1.6\pgfutil@tempdima}
  \anchor{inputdb}{\northeast \pgfutil@tempdima=\halfwidth\advance\pgf@x by -1.2\pgfutil@tempdima}
  \anchor{inputdc}{\northeast \pgfutil@tempdima=\halfwidth\advance\pgf@x by 0.8\pgfutil@tempdima}
  \anchor{inputdd}{\northeast \pgfutil@tempdima=\halfwidth\advance\pgf@x by 0.4\pgfutil@tempdima}
  \anchor{inputea}{\northeast \pgfutil@tempdima=\halfwidth\advance\pgf@x by -1.667\pgfutil@tempdima}
  \anchor{inputeb}{\northeast \pgfutil@tempdima=\halfwidth\advance\pgf@x by -1.333\pgfutil@tempdima}
  \anchor{inputec}{\northeast \pgf@x=0pt}
  \anchor{inputed}{\northeast \pgfutil@tempdima=\halfwidth\advance\pgf@x by 0.667\pgfutil@tempdima}
  \anchor{inputee}{\northeast \pgfutil@tempdima=\halfwidth\advance\pgf@x by 0.333\pgfutil@tempdima}
  
  \backgroundpath{
    \pgfpathrectanglecorners{\southwest}{\northeast}
  }
}

\pgfdeclareshape{clockedblock}{
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \inheritanchorborder[from=rectangle]
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }
  \anchor{Clk}{
    \pgf@process{\northeast}%
    \pgf@x=-1\pgf@x%
    \pgf@y=-0.5\pgf@y
  }
  % Draw the rectangle box and the port labels
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}
    % Angle (>) for clock input
    \pgf@anchor@clockedblock@Clk
    \pgf@xa=\pgf@x \pgf@ya=\pgf@y
    \pgf@xb=\pgf@x \pgf@yb=\pgf@y
    \pgf@xc=\pgf@x \pgf@yc=\pgf@y
    \pgfmathsetlength\pgf@x{1.6ex} % size depends on font size
    \advance\pgf@ya by \pgf@x
    \advance\pgf@xb by \pgf@x
    \advance\pgf@yc by -\pgf@x
    \pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
    \pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yb}}
    \pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
    \pgfclosepath
  }
}

\pgfdeclareshape{unclockedblock}{
  \savedanchor\northeast{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=0.5\pgf@x
    \pgf@y=0.5\pgf@y
  }
  \savedanchor\southwest{%
    \pgfmathsetlength\pgf@x{\pgfshapeminwidth}%
    \pgfmathsetlength\pgf@y{\pgfshapeminheight}%
    \pgf@x=-0.5\pgf@x
    \pgf@y=-0.5\pgf@y
  }
  \inheritanchorborder[from=rectangle]
  \anchor{center}{\pgfpointorigin}
  \anchor{north}{\northeast \pgf@x=0pt}
  \anchor{east}{\northeast \pgf@y=0pt}
  \anchor{south}{\southwest \pgf@x=0pt}
  \anchor{west}{\southwest \pgf@y=0pt}
  \anchor{north east}{\northeast}
  \anchor{north west}{\northeast \pgf@x=-\pgf@x}
  \anchor{south west}{\southwest}
  \anchor{south east}{\southwest \pgf@x=-\pgf@x}
  \anchor{text}{
    \pgfpointorigin
    \advance\pgf@x by -.5\wd\pgfnodeparttextbox%
    \advance\pgf@y by -.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by +.5\dp\pgfnodeparttextbox%
  }
  % Draw the rectangle box and the port labels
  \backgroundpath{
    % Rectangle box
    \pgfpathrectanglecorners{\southwest}{\northeast}
    \pgfclosepath
  }
}